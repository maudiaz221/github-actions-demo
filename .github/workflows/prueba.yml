name: Chequeador inicial

on: [push]

jobs:
  deny-push-and-auto-merge:
    run on: ubuntu-latest

  
  steps:
    - name: Check commit author and name
    id: check actor
    run: |
      if [[ "${{github.actor}}" == "OMAR" && "${{github.event.head_commit.message}}" == "282542200"]]; then
        echo "::set-output name=deny_push::true"
      else
        echo "::set-output name=deny_push::false"
      fi
    - name: Check commit message
    id: check commit message
    run: |
      if [[ "${{github.event.head_commit.message}}" == "282542200" ]]; then
        echo "::set-output name=accept_push::true"
      else
        echo "::set-output name=accept_push::false"
      fi
    
    - name: Deny push
    if: steps.check_actor.outputs.deny_push == 'true' || steps.check_commit_message.outputs.accept_push == 'false'
    run: |
      echo "you are not allowed to push to this repository"
      exit 1

    
    - name: Allow push
    if: steps.check_actor.outputs.deny_push == 'false' && steps.check_commit_message.outputs.accept_push == 'true'
    run: |
      echo "you are allowed to push to this repository"
      git merge <branch_name>
      